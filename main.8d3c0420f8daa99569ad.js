(()=>{"use strict";const e=class{constructor(e){this.params=e,this.results=[],this.getResultsFromStorage(),this.getSettings()}setTitle(e){document.title=e}getResultsFromStorage(){const{type:e}=this.params;let t=[];t="blitz"===e?JSON.parse(localStorage.getItem("blitzResults"))||[]:JSON.parse(localStorage.getItem(`${e}Results`))||[{name:"baroque",isPlayed:!1,results:0},{name:"historical",isPlayed:!1,results:0},{name:"impressionism",isPlayed:!1,results:0},{name:"landscape",isPlayed:!1,results:0},{name:"modernism",isPlayed:!1,results:0},{name:"portrait",isPlayed:!1,results:0},{name:"realism",isPlayed:!1,results:0},{name:"renaissance",isPlayed:!1,results:0},{name:"romanticism",isPlayed:!1,results:0},{name:"symbolism",isPlayed:!1,results:0},{name:"avant-garde",isPlayed:!1,results:0},{name:"still-life",isPlayed:!1,results:0}],this.results=t}getSettings(){this.isWithSound=JSON.parse(localStorage.getItem("isWithSound")||!0),this.isWithTimer=JSON.parse(localStorage.getItem("isWithTimer")||!0),this.soundValue=JSON.parse(localStorage.getItem("soundValue")||.5),this.timerValue=JSON.parse(localStorage.getItem("timerValue")||30),this.langValue=localStorage.getItem("langValue")||"en"}async translatePage(){this.translator=new class{constructor(e){this.lang=e||"en",this.elements=document.querySelectorAll("[data-langkey]")}async loadLang(){const e=await fetch(`/data/ui/${this.lang}.json`);this.data=await e.json()}async translate(){await this.loadLang(),this.elements.forEach((e=>{const t=e.dataset.langkey,s=this.data[t];e.textContent=s}))}}(this.langValue),await this.translator.translate()}mount(){return""}},t=class{constructor(e){this.arr=e,this.thumbs=document.querySelectorAll(".image-loading")}async preloadImage(e){return new Promise((t=>{const s=new Image;s.onload=t,s.onerror=t,s.src=e}))}async preloadOneImage(e,t){await new Promise((t=>{const s=new Image;s.onload=t,s.onerror=t,s.src=e})),t.classList.remove("one-image-loading")}hideThumbs(){this.thumbs.forEach((e=>{e.classList.remove("image-loading")}))}async preloadImages(e="all"){if("all"===e)await Promise.all(this.arr.map((e=>this.preloadImage(e)))),this.hideThumbs();else if("four"===e){const e=this.arr.splice(0,4);this.arr.length>0&&(await Promise.all(e.map((e=>this.preloadImage(e)))),this.hideThumbs(),this.preloadImages("four"))}}},s=class extends e{constructor(e){super(e);const t="en"===this.langValue?"home":"главная";this.setTitle(`artquiz. - ${t}.`)}async mounted(){const e=new t(["../img/artists.webp","../img/pictures.webp","../img/logo.png"]);await e.preloadImages(),this.translatePage()}mount(){return'\n    <header>\n      <div class="container">\n        <div class="header header-home">\n          <a href="settings" class="header-home__nav header__nav header__nav--right btn" data-link>\n            <ion-icon name="settings"></ion-icon>\n          </a>\n        </div>\n      </div>\n    </header>\n\n    <main class="main">\n      <div class="container">\n        <div class="home">\n          <div class="home-logo image-loading"></div>\n          <div class="home-types">\n            <a class="home-types__type" href="/categories/artists" data-link>\n              <div class="home-types__image artist image-loading"></div>\n              <div class="home-types__text" data-langkey="artists-quiz">artists quiz</div>\n            </a>\n            <a class="home-types__type" href="/categories/pictures" data-link>\n              <div class="home-types__image pictures image-loading"></div>\n              <div class="home-types__text" data-langkey="pictures-quiz">pictures quiz</div>\n             </a>\n            <a class="home-types__type" href="/blitz" data-link>\n              <div class="home-types__image blitz-image image-loading"></div>\n              <div class="home-types__text" data-langkey="blitz-quiz">blitz quiz</div>\n             </a>\n          </div>\n        </div>\n      </div>\n    </main>\n    \n    <footer>\n      <div class="container">\n        <div class="footer">\n          <a class="footer__github" href="https://github.com/liliyavoloshina">liliyavoloshina</a>\n          <div class="footer__year">© 2021</div>\n          <a class="footer__school" href="https://rs.school/js/" title="Rolling Scopes School"></a>\n        </div>\n      </div>\n    </footer>\n    '}},i=e=>{e.preventDefault(),e.target.classList.remove("animate"),e.target.classList.add("animate"),setTimeout((()=>{e.target.classList.remove("animate")}),700)},n=(e,t="en",s)=>{if("artists"===e)return"en"===t?`this picture was painted in ${s}`:`эта картина нарисована в ${s}`;const i=s.split(" "),n=[];return i.forEach((e=>{const t=(s=e).split("").map(((e,t)=>0===t||1===t||t===s.length-1?e:"*")).join("");var s;n.push(t)})),n.join(" ")},a=e=>{for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},o=async(e,t)=>{const s=await fetch(`/data/${e}-${t}.json`);return await s.json()},r=(e,t)=>{const s=e+Math.random()*(t+1-e);return Math.floor(s)},l=(e,t)=>{localStorage.setItem(e,t)},c=class{constructor(e,t,s){this.id=e,this.name=t,this.checked=s}mount(e){const t=(e=>{const t=document.createElement("template");return t.innerHTML='<div class="checkbox"> <label> <ion-icon name="checkmark-sharp"></ion-icon> </label> </div>',t.content.firstChild})(),s=document.createElement("input");s.type="checkbox",s.id=this.id,s.checked=this.checked,t.prepend(s),t.querySelector("label").htmlFor=this.id,t.addEventListener("change",(e=>l(this.name,e.target.checked))),e.append(t)}},d=class extends e{constructor(e){super(e);const t="en"===this.langValue?"settings":"настройки";this.setTitle(`artquiz. - ${t}.`)}updateLang(e){localStorage.setItem("langValue",e),this.langValue=e,this.translatePage()}changeTimerValue(e){"decr"===e&&this.timerValue<=30&&this.timerValue>5&&(this.timerValue-=5),"incr"===e&&this.timerValue<30&&this.timerValue>=5&&(this.timerValue+=5),this.timerInput.classList.add("changed");const t=()=>{this.timerInput.removeEventListener("animationend",t),this.timerInput.classList.remove("changed")};this.timerInput.addEventListener("animationend",t),this.timerInput.value=this.timerValue,l("timerValue",this.timerValue)}bindListeners(){this.soundRange.addEventListener("input",(e=>{const t=(.01*e.target.value).toFixed(2);l("soundValue",t)})),this.incrTimerBtn.addEventListener("click",(()=>{this.changeTimerValue("incr")})),this.decrTimerBtn.addEventListener("click",(()=>{this.changeTimerValue("decr")})),this.swicthLangEn.addEventListener("change",(()=>{this.updateLang("en")})),this.swicthLangRu.addEventListener("change",(()=>{this.updateLang("ru")}))}mounted(){const e=document.querySelector("#soundCheckboxContainer");new c("soundCheckbox","isWithSound",this.isWithSound).mount(e);const t=document.querySelector("#timerCheckboxContainer");new c("timerCheckbox","isWithTimer",this.isWithTimer).mount(t),this.soundRange=document.querySelector("#soundRange"),this.decrTimerBtn=document.querySelector("#decrTimerBtn"),this.incrTimerBtn=document.querySelector("#incrTimerBtn"),this.timerInput=document.querySelector("#timerInput"),this.swicthLangEn=document.querySelector("#swicthLangEn"),this.swicthLangRu=document.querySelector("#swicthLangRu"),this.soundRange.value=100*this.soundValue,this.timerInput.value=this.timerValue,"en"===this.langValue?this.swicthLangEn.checked=!0:this.swicthLangRu.checked=!0,this.bindListeners(),this.translatePage()}mount(){return'\n    <header>\n        <div class="container">\n            <div class="header header-settings">\n                <a href="/" class="header-settings__nav header__nav header__nav--left btn" title="back" data-link><ion-icon name="chevron-back-outline"></ion-icon></a>\n                <h1 class="header__title" data-langkey="header">settings.</h1>\n            </div>\n        </div>\n    </header>\n\n    <main class="main">\n        <div class="container container-settings">\n            <div class="settings">\n                <div class="settings-block">\n                    <div class="settings-block__input" id="soundCheckboxContainer"></div>\n                    <div class="settings-block__input regulation">\n                        <input class="range" type="range" min="1" id="soundRange">\n                    </div>\n                    <div class="settings-block__text" data-langkey="music">music</div>\n                </div>\n                <div class="settings-block">\n                    <div class="settings-block__input" id="timerCheckboxContainer"></div>\n                    <div class="settings-block__input regulation">\n                        <div class="input-number">\n                          <button class="input-number__btn" type="number" id="decrTimerBtn"><ion-icon name="remove-sharp"></ion-icon></button>\n                          <input class="input-number__input" type="number" id="timerInput" disabled>\n                          <button class="input-number__btn" type="number" id="incrTimerBtn"><ion-icon name="add-sharp"></ion-icon></button>\n                        </div>\n                    </div>\n                    <div class="settings-block__text" data-langkey="timer">timer</div>\n                </div>\n                <div class="settings-block">\n                    <div class="settings-block__input-radios regulation"><span>en</span><span>ru</span></div>\n                    <div class="settings-block__input-radios regulation">\n                      <div class="radio">\n                        <input id="swicthLangEn" type="radio" name="radio" value="en">\n                        <label for="swicthLangEn"></label>\n                      </div>\n                      <div class="radio">\n                        <input id="swicthLangRu" type="radio" name="radio" value="ru">\n                        <label for="swicthLangRu"></label>\n                      </div>\n                    </div>\n                    <div class="settings-block__text" data-langkey="language">language</div>\n                </div>\n            </div>\n        </div>\n    </main>\n    \n    <footer>\n      <div class="container">\n        <div class="footer">\n            <a class="footer__github" href="https://github.com/liliyavoloshina">liliyavoloshina</a>\n            <div class="footer__year">© 2021</div>\n            <a class="footer__school" href="https://rs.school/js/" title="Rolling Scopes School"></a>\n        </div>\n      </div>\n    </footer>\n    '}},h=class extends e{constructor(e){super(e);const t="en"===this.langValue?"categories":"категории";this.setTitle(`artquiz. - ${t}.`),this.type=this.params.type,this.correctResults=this.results}getCorrectNumber(e){return e?e.filter((e=>e.isCorrect)).length:null}categoriesToHtml(){const e=document.querySelector("#categoriesContainer");this.results.forEach((t=>{const{isPlayed:s}=t,i=t.name.split("-").join(" "),n=this.getCorrectNumber(t.results);new class{constructor(e,t,s,i,n){this.isPlayed=e,this.type=t,this.categoryName=s,this.correctNumber=i,this.splittedName=n}generate(){return`\n    <div class="category__header ${this.isPlayed?"":"hidden"}">\n      <a class="category__score btn" href="/score/${this.type}/${this.categoryName}" data-link>\n        <ion-icon name="star"></ion-icon>\n      </a>\n      <div class="category__results">${this.correctNumber}/10</div>\n    </div>\n    \n    <a class="category__name ${this.isPlayed?"played":""}" href="/quiz/${this.type}/${this.categoryName}" data-link\n      data-langkey="${this.categoryName}">${this.splittedName}</a>\n    <a class="category__image image-loading ${this.isPlayed?"":"inversed"}" href="/quiz/${this.type}/${this.categoryName}"\n      data-link>\n      <img src="../img/category/${this.type}/${this.categoryName}.webp" alt="${this.categoryName} quiz">\n    </a>\n    `}mount(e){const t=document.createElement("div");t.classList.add("category"),t.innerHTML=this.generate(),e.append(t)}}(s,this.type,t.name,n,i).mount(e)}))}async loadImages(){const e=[];for(let t=0;t<12;t++){const s=this.results[t].name,i=`../img/category/${this.type}/${s}.webp`;e.push(i)}const s=new t(e);await s.preloadImages()}async mounted(){this.categoriesToHtml(),this.translatePage(),await this.loadImages()}mount(){return`\n    <header>\n        <div class="container">\n            <div class="header header-categories">\n                <a href="/" class="header-categories__nav header__nav--left header__nav btn" title="Back" data-link><ion-icon name="chevron-back-outline"></ion-icon></a>\n                <h1 class="header__title"><span data-langkey="${this.type}"></span>.</h1>\n            </div>\n        </div>\n    </header>\n\n    <main class="main">\n        <div class="container">\n            <div class="categories" id="categoriesContainer"></div>\n        </div>\n    </main>\n\n    <footer>\n        <div class="container">\n            <div class="footer">\n                <a class="footer__github" href="https://github.com/liliyavoloshina">liliyavoloshina</a>\n                <div class="footer__year">© 2021</div>\n                <a class="footer__school" href="https://rs.school/js/" title="Rolling Scopes School"></a>\n            </div>\n        </div>\n    </footer>\n    `}};class u{constructor(e,t){this.isWithSound=e,this.volume=t}play(e){if(!this.isWithSound)return;const t=new Audio;t.volume=this.volume,t.src=e?"/audio/correct.wav":"/audio/incorrect.wav",t.play()}}const m="pictures",g="artists",v=class{constructor(e,t,s,i=""){this.type=e,this.imageNum=t,this.hint=s,this.correctAnswer=i}generate(){return`\n    <img class="image__img" src="/img/full/${this.imageNum}full.webp" width="500" height="500" />\n    <div class="image__fullscreen image__actions" title="zoom image">\n      <ion-icon name="search-outline"></ion-icon>\n    </div>\n    <div class="image__hint image__actions" title="hint">\n      <div class="tooltip btn-anim">\n        <ion-icon name="help-circle-outline"></ion-icon>\n        <div class="tooltip__content">${this.hint}</div>\n      </div>\n    </div>\n    `}mount(e){const t=document.createElement("div");if(t.classList.add("image","image-loading"),"artists"===this.type?t.classList.add("artists"):t.classList.add("pictures"),t.innerHTML=this.generate(),"pictures"===this.type){const e=t.querySelector(".image__img");e.dataset.name=this.correctAnswer,e.classList.add("answer")}e.append(t)}},p=class{constructor(e,t=""){this.timerValue=e,this.type=t}pauseTimer(){this.isPaused||(this.isPaused=!0,clearInterval(this.interval),this.circleSvg.style.animationPlayState="paused",this.disSeconds.style.animationPlayState="paused")}stopTimer(){clearInterval(this.interval),this.oldValue=getComputedStyle(this.circleSvg).getPropertyValue("stroke-dashoffset"),this.circleSvg.style.strokeDashoffset=this.oldValue,this.circleSvg.style.animation="none"}playTimer(){if(this.isPaused)return;const e=60===this.totalTime?60:this.totalTime%60;this.totalTime<=this.red?(this.circleSvg.style.stroke="var(--red)",this.disSeconds.style.animation="popup 1s infinite ease-in-out",this.disSeconds.style.animationPlayState="running"):this.totalTime<=this.yellow?(this.circleSvg.style.stroke="var(--timer-circle-yellow)",this.disSeconds.style.animation="none"):(this.circleSvg.style.stroke="var(--green)",this.disSeconds.style.animation="none"),this.totalTime>0?this.totalTime--:(clearTimeout(this.interval),this.circleSvg.style.strokeDashoffset="0",this.circleSvg.style.animation="none",this.disSeconds.style.animation="none"),this.validateTime(this.disSeconds,e)}setInterval(){this.interval=setInterval((()=>{this.playTimer(),this.disSeconds.style.animationPlayState="running",this.circleSvg.style.animationPlayState="running"}),1e3)}initTimer(){this.interval=!1,this.isPaused=!1,this.totalTime=this.timerValue,this.yellow=Math.floor(this.totalTime/2),this.red=Math.floor(this.totalTime/4),clearTimeout(this.interval),this.validateTime(this.disSeconds,this.totalTime),this.circleSvg.style.animation=`loop ${this.totalTime}s linear`,this.circleSvg.style.strokeDashoffset="1590",this.play()}resumeTimer(){this.isPaused&&(this.play(),this.isPaused=!1)}play(){this.playTimer(),this.setInterval()}validateTime(e,t){e.innerHTML=t<10?`0${t}`:t}generate(){return'\n    <div class="timer__display">\n      <div class="display seconds"></div>\n    </div>\n    <svg class="circle" x="0px" y="0px" width="500px" height="500px" viewBox="0 0 521.17 521.17">\n      <circle cx="260.59" cy="260.59" r="253.09" stroke-width="18" fill="none" />\n    </svg>\n    '}mount(e){const t=document.createElement("div");t.classList.add("timer"),t.innerHTML=this.generate(),e.append(t);const s=!!document.querySelector("#addedTime");if("blitz"===this.type&&!s){const t=document.createElement("div");t.classList.add("timer__added-time","hidden"),t.id="addedTime",e.prepend(t)}this.timer=document.querySelector(".timer"),this.disSeconds=document.querySelector(".seconds"),this.circleSvg=document.querySelector("circle"),this.oldValue=getComputedStyle(this.circleSvg).getPropertyValue("stroke-dashoffset")}},y=class{constructor(){this.containerEl=null,this.confettiFrequency=3,this.confettiSize=15,this.confettiColors=["#fce18a","#ff726d","#b48def","#f4306d"],this.confettiAnimations=["slow","medium","fast"]}init(){const e=document.createElement("div"),t=this.el.style.position;"relative"===t&&"absolute"===t||(this.el.style.position="fixed"),e.classList.add("confetti-container"),this.el.appendChild(e),this.containerEl=e,this.render()}render(){this.confettiInterval=setInterval((()=>{const e=document.createElement("div"),t=`${Math.floor(3*Math.random())+this.confettiSize}px`,s=this.confettiColors[Math.floor(Math.random()*this.confettiColors.length)],i=`${Math.floor(Math.random()*this.el.offsetWidth)}px`,n=this.confettiAnimations[Math.floor(Math.random()*this.confettiAnimations.length)];e.classList.add("confetti",`confetti--animation-${n}`),e.style.left=i,e.style.width=t,e.style.height=t,e.style.backgroundColor=s,e.removeTimeout=setTimeout((()=>{e.parentNode.removeChild(e)}),1e3),this.containerEl.appendChild(e)}),25)}mount(){const e=document.createElement("div");e.classList.add("confetti-wrapper","hidden"),e.id="quizConfetti",document.querySelector("#app").append(e),this.el=document.querySelector(".confetti-wrapper"),this.el.classList.remove("hidden")}},f=class extends e{constructor(e){super(e);const t="en"===this.langValue?"quiz":"игра";this.setTitle(`artquiz. - ${t}.`),this.type=e.type,this.category=e.category,this.allQuestions=[],this.questions=[],this.correctAnswers=[],this.currentQuestion=0,this.rightAnswer="",this.isCorrect=!1,this.picturesImages=[],this.timerTimeout=!1,this.isModalOpened=!1,this.isHintUsed=!1}async filterQuestions(){this.questions=this.allQuestions.filter((e=>e.genre===this.category))}nextQuestion(){this.rightAnswer="",this.isCorrect=!1,this.isHintUsed=!1,this.closeModal(),10!==this.currentQuestion?(this.generateQuestion(),this.showNextImage(),this.showNextAnswers(),this.generateAnswers(),this.isWithTimer&&this.initTimer()):this.showResults()}showNextImage(){this.sliderTransformer.transform(this.currentQuestion)}showNextAnswers(){this.type===g&&(this.questionTextEl.classList.add("hidden"),this.questionTextEl.addEventListener("animationend",(()=>{this.questionTextEl.classList.remove("hidden")})),this.answersEl.forEach((e=>{e.classList.add("hidden"),e.addEventListener("animationend",(()=>{e.classList.remove("hidden")}))})))}setResultsToStorage(){const e=[];this.questions.forEach((t=>{this.correctAnswers.includes(t)?e.push({imageNum:t.imageNum,isCorrect:!0}):e.push({imageNum:t.imageNum,isCorrect:!1})}));const t={name:this.category,isPlayed:!0,results:e},s=this.results.findIndex((e=>e.name===this.category));this.results[s]=t,localStorage.setItem(`${this.type}Results`,JSON.stringify(this.results))}showResults(){const e=document.querySelector("#modalResult"),t=document.querySelector("#resultsText"),s=document.querySelector("#correctAnswersCount"),i=this.correctAnswers.length;this.soundResults=new Audio,this.soundResults.volume=this.soundValue,10===i?(t.textContent="en"===this.langValue?"are you an art expert?!":"да ты эксперт!",this.soundResults.src="/audio/applause.wav"):i>5&&i<10?(t.textContent="en"===this.langValue?"wow, you are on fire!":"потрясающе!",this.soundResults.src="/audio/applause.wav"):(t.textContent="en"===this.langValue?"you can do better!":"ты можешь лучше!",this.soundResults.src="/audio/failure.wav"),this.isWithSound&&this.soundResults.play(),this.setResultsToStorage(),s.textContent=i,e.classList.remove("hidden"),i>5&&e.addEventListener("transitionend",(()=>{const e=new y;e.mount(),e.init()}))}generateQuestion(){if(this.type===g)this.questionTextEl.textContent="en"===this.langValue?"who is the author of this picture?":"кто автор этой картины?";else{const e=this.questions[this.currentQuestion].author;this.questionTextEl.textContent="en"===this.langValue?`which is ${e} picture?`:`какую картину написал ${e}?`}}async generateImages(){const e=[];if(this.type===g)this.questions.forEach((t=>{const{imageNum:s}=t,{year:i}=this.questions[this.currentQuestion],a=n(g,this.langValue,i);e.push(`/img/full/${s}full.webp`),new v(this.type,s,a).mount(this.imagesSlider)}));else{const t=[];for(;t.length<30;){const e=this.allQuestions[Math.floor(Math.random()*this.allQuestions.length)],s=e.author,i=e.imageNum,n=this.questions.some((e=>e.imageNum===i));!1==!!t.find((e=>e.author===s))&&!1===n&&t.push(e)}const s=[];for(let e=0;e<40;e+=4){const t=r(e,e+3);s.push(t)}for(let e=0;e<this.questions.length;e++)t.splice(s[e],0,this.questions[e]);this.picturesImages=t,t.forEach((t=>{const{imageNum:s}=t,{author:i,name:a}=this.allQuestions.find((e=>e.imageNum===s)),o=n(m,this.langValue,i);e.push(`/img/full/${s}full.webp`),new v(this.type,s,o,a).mount(this.imagesSlider)}))}const s=new t(e);this.imageActions=document.querySelectorAll(".image__actions"),this.type===g?await s.preloadImages():await s.preloadImages("four"),this.imagesEl=document.querySelectorAll(".image__img"),this.type===m&&(this.answersEl=document.querySelectorAll(".answer"))}generateAnswers(){const e=[];if(this.type===g){const t=this.questions[this.currentQuestion].author;for(this.rightAnswer=t,e.push(t);e.length<4;){const t=this.allQuestions[Math.floor(Math.random()*this.allQuestions.length)];e.includes(t.author)||e.push(t.author)}a(e),this.answersEl.forEach(((t,s)=>t.textContent=e[s]))}else{const t=this.questions[this.currentQuestion].name;this.rightAnswer=t;let s=[];s=4===this.picturesImages.length?this.picturesImages:this.picturesImages.splice(0,4),s.forEach((t=>{e.push(t.name)}))}this.answersEl.forEach((e=>{e.classList.remove("correct"),e.classList.remove("incorrect")}))}disableAnswer(){this.type===g&&this.answersEl.forEach((e=>e.disabled=!e.disabled)),this.imagesEl.forEach((e=>e.classList.toggle("disabled"))),this.imageActions.forEach((e=>e.classList.toggle("disabled")))}closeModal(){this.modal.classList.add("hidden"),this.isModalOpened=!1,setTimeout((()=>{this.disableAnswer()}),1e3)}openModal(){this.modal.classList.remove("hidden"),this.isModalOpened=!0}fullscreenImage(e){this.isWithTimer&&this.timer&&(clearTimeout(this.timerTimeout),this.timer.pauseTimer());const t=e.previousElementSibling;this.modalFullscreen=document.querySelector("#modalFullscreen"),this.imageFullscreen=document.querySelector("#imageFullscreen"),this.modalFullscreen.classList.remove("hidden"),this.imageFullscreen.src=t.src,this.modalFullscreen.addEventListener("click",(()=>{this.closeFullscreenImage()}))}closeFullscreenImage(){this.imageFullscreen.classList.add("out"),setTimeout((()=>{this.isWithTimer&&(this.timer.resumeTimer(),clearTimeout(this.timerTimeout),this.setTimeout(this.timer.totalTime+1)),this.modalFullscreen.classList.add("hidden"),this.imageFullscreen.classList.remove("out")}),400)}async generateModal(){const e=document.querySelector("#modalFirstLine"),s=document.querySelector("#modalSecondLine"),i=document.querySelector("#modalYear"),n=document.querySelector("#modalImage"),a=document.querySelector("#checkmark"),o=document.querySelector("#crossmark"),r=this.questions[this.currentQuestion].imageNum,l=this.questions[this.currentQuestion].name,c=this.questions[this.currentQuestion].author,d=this.questions[this.currentQuestion].year,h=`/img/full/${r}full.webp`,u=document.querySelector(".modal__image");n.src=h,this.isCorrect?(o.classList.add("hidden"),a.classList.remove("hidden"),this.checkmarkCheck.classList.add("animated")):(a.classList.add("hidden"),o.classList.remove("hidden"),this.crossmarkCheck.classList.add("animated")),this.type===g?(e.textContent="en"===this.langValue?`"${l}" was created`:`"${l}" написал`,s.textContent="en"===this.langValue?`by ${c}`:`${c}`,i.textContent="en"===this.langValue?`in ${d}`:`в ${d} году`):(e.textContent="en"===this.langValue?`${c} created`:`${c} написал`,s.textContent=`"${l}"`,i.textContent="en"===this.langValue?`in ${d}`:`в ${d} году`),(new t).preloadOneImage(h,u)}findElements(){this.answersEl=document.querySelectorAll(".answer"),this.crossmarkCheck=document.querySelector(".crossmark"),this.checkmarkCheck=document.querySelector(".checkmark"),this.questionTextEl=document.querySelector("#quizQuestionText"),this.modal=document.querySelector(".modal"),this.imagesSlider=document.querySelector("#quizImages")}stopTimer(){this.isWithTimer&&this.timer&&(clearTimeout(this.timerTimeout),this.timer.stopTimer())}stopTimerAndSounds(){this.stopTimer(),this.soundResults&&this.soundResults.pause()}observeLocation(){const e=document.querySelectorAll(".back-link");document.querySelector("#nextQuizBtn").addEventListener("click",(()=>{this.stopTimerAndSounds()})),e.forEach((e=>{e.addEventListener("click",(()=>{this.stopTimerAndSounds()}))})),window.addEventListener("popstate",(()=>{this.stopTimerAndSounds()}))}showHint(e){this.type===m&&this.isHintUsed&&!e.classList.contains("opened")||(this.isHintUsed=!0,e.classList.toggle("opened"))}bindListeners(){document.querySelector("#quizContainer").addEventListener("click",(e=>{const{target:t}=e,s=t.classList.contains("answer"),i=t.classList.contains("tooltip"),n=t.classList.contains("image__fullscreen");s&&this.answer(t),i&&this.showHint(t),n&&this.fullscreenImage(t)})),document.querySelector("#modalBtn").addEventListener("click",(()=>{this.nextQuestion()})),this.modal.addEventListener("transitionend",(()=>{!1===this.isModalOpened&&(this.crossmarkCheck.classList.remove("animated"),this.checkmarkCheck.classList.remove("animated"))})),document.querySelectorAll(".btn-anim").forEach((e=>{e.addEventListener("click",i)}))}async answer(e){this.isWithTimer&&this.timer&&(clearTimeout(this.timerTimeout),this.timer.stopTimer());const t=document.querySelectorAll(".pag-item");let s;s=this.type===g?"timeout"===e?"timeout":e.innerHTML:e.dataset?e.dataset.name:"timeout",s===this.rightAnswer?(this.isCorrect=!0,t[this.currentQuestion].classList.add("correct"),this.correctAnswers.push(this.questions[this.currentQuestion]),e.classList.add("correct")):"timeout"===s?(this.isCorrect=!1,t[this.currentQuestion].classList.add("incorrect")):(this.isCorrect=!1,t[this.currentQuestion].classList.add("incorrect"),e.classList.add("incorrect")),this.playSound.play(this.isCorrect),10!==this.currentQuestion&&(await this.generateModal(),this.openModal()),this.currentQuestion++,this.disableAnswer()}setTimeout(e){this.timerTimeout=setTimeout((()=>{this.answer("timeout")}),1e3*e)}initTimer(){this.timer.initTimer(),this.setTimeout(this.timerValue)}async mounted(){if(this.findElements(),this.observeLocation(),this.allQuestions=await o(this.type,this.langValue),await this.filterQuestions(),this.generateQuestion(),await this.generateImages(),this.generateAnswers(),this.isWithTimer){const e=document.querySelector("#header");this.timer=new p(this.timerValue),this.timer.mount(e),this.initTimer()}this.sliderTransformer=new class{constructor(e){this.type=e,this.slider=document.querySelector("#quizImages")||document.querySelector("#blitzImages"),this.images=this.slider.querySelectorAll(".image"),this.transformPictures=-200,this.bind(),this.calculateView()}calculateView(){window.matchMedia("(min-width: 768px)").matches?this.transformPictures=-200:this.transformPictures=-400}transform(e){"artists"===this.type||"blitz"===this.type?this.images.forEach((t=>{t.style.transform=`translateY(${-100*e}%)`})):this.slider.style.transform=`translateY(${-100*e}%)`}bind(){window.addEventListener("resize",(()=>this.calculateView()))}}(this.type),this.playSound=new u(this.isWithSound,this.soundValue),this.bindListeners(),this.translatePage()}mount(){return`\n    <header>\n      <div class="container">\n        <div class="header header-quiz" id="header">\n          <a href="/categories/${this.type}" class="header-quiz__nav header__nav header__nav--left btn back-link" title="back" data-link><ion-icon name="chevron-back-outline"></ion-icon></a>\n          <a href="/" class="header-quiz__nav header__nav header__nav--right btn back-link" title="home" data-link><ion-icon name="home"></ion-icon></a>\n        </div>\n      </div>\n    </header>\n\n  <main class="main main-fullheight">\n    <div class="container">\n      <div class="quiz" id="quizContainer">\n        <div class="quiz__question" id="quizQuestionText"></div>\n        <div class="quiz-slider">\n          <div class="quiz__images ${"pictures"===this.type?"pictures":"artists"}" id="quizImages"></div>\n        </div>\n        <div class="quiz__pag">\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n          <div class="pag-item"></div>\n        </div>\n        ${"pictures"===this.type?"":'<div class="quiz__answers " id="quizAnswers">\n        <button class="answer-btn answer"></button>\n        <button class="answer-btn answer"></button>\n        <button class="answer-btn answer"></button>\n        <button class="answer-btn answer"></button>\n      </div>'}\n      </div>\n    </div>\n  </main>\n\n  <footer>\n    <div class="container">\n      <div class="footer">\n        <a class="footer__github" href="https://github.com/liliyavoloshina">liliyavoloshina</a>\n        <div class="footer__year">© 2021</div>\n        <a class="footer__school" href="https://rs.school/js/" title="Rolling Scopes School"></a>\n      </div>\n    </div>\n  </footer>\n\n  <div class="modal hidden">\n    <div class="modal__status" id="modalStatus">\n    <div id="checkmark"><svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg></div>\n    <div id="crossmark">\n      <svg class="crossmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="crossmark__circle" cx="26" cy="26" r="25" fill="none"/>\n        <path class="cross__path cross__path--right" fill="none" d="M16,16 l20,20" />\n        <path class="cross__path cross__path--left" fill="none" d="M16,36 l20,-20" />\n      </svg>\n    </div>\n    </div>\n    <div class="modal__main">\n      <div class="modal__image one-image-loading">\n        <img\n          src=""\n          alt=""\n          id="modalImage"\n        />\n      </div>\n      <div class="modal__text">\n        <div class="name" id="modalFirstLine"></div>\n        <div class="author" id="modalSecondLine"></div>\n        <div class="year" id="modalYear"></div>\n      </div>\n    </div>\n    <div class="modal__btn">\n      <button class="btn-lg" id="modalBtn" data-langkey="next">next</button>\n    </div>\n  </div>\n\n  <div class="modal-center hidden" id="modalResult">\n    <div class="modal-center__content">\n      <div class="modal-center__title" id="resultsText"></div>\n      <div class="modal-center__info"><span id="correctAnswersCount"></span>/10</div>\n      <div class="modal-center__actions">\n        <a href="/" class="btn back-link" data-langkey="home" data-link>home</a>\n        <a href="/categories/${this.type}" class="btn" id="nextQuizBtn" data-langkey="next-quiz" data-link>next quiz</a>\n      </div>\n  </div>\n</div>\n\n<div class="modal-image hidden" id="modalFullscreen">\n    <div class="modal-image__wrapper">\n      <img class="modal-image__image" id="imageFullscreen">\n    </div>\n</div>\n\n<div class="confetti-wrapper hidden" id="quizConfetti"></div>\n    `}},_=class extends e{constructor(e){super(e);const t="en"===this.langValue?"score":"результаты";this.setTitle(`artquiz. - ${t}.`),this.type=this.params.type,this.category=this.params.category,this.totalScore=0}async setHeader(){const e=document.querySelector("#scoreHeader");let t,s;"en"===this.langValue?(t=this.category,s=this.type,e.textContent=`${t} ${s}`):(t=this.translator.data[this.category],s="pictures"===this.type?"картины":"художники",e.textContent=`${s} ${t}`)}async scoreToHtml(){const e=[];this.scoreResults?this.scoreResults.forEach((t=>{const{isCorrect:s}=t;s&&(this.totalScore+=1),e.push(`/img/small/${t.imageNum}full.webp`),new class{constructor(e,t){this.isCorrect=e,this.imageNum=t.imageNum,this.name=t.name,this.author=t.author,this.year=t.year}generate(){return`\n    <div class="score__img ${this.isCorrect?"":"inversed"}">\n      <img src="/img/small/${this.imageNum}full.webp" alt="${this.name}" />\n    </div>\n    <div class="popup-score hidden">\n      <div class="popup-score__name">"${this.name}"</div>\n      <div class="popup-score__author">${this.author}</div>\n      <div class="popup-score__year">${this.year}</div>\n    </div>\n    `}mount(e){const t=document.createElement("div");t.classList.add("score__item"),t.innerHTML=this.generate(),e.append(t)}}(s,t).mount(this.scoreContainer)})):this.scoreContainer.innerHTML='\n      <div class="restrictive-message">\n        <h2 class="restrictive-message__title" data-langkey="res-mes-title"></h2>\n        <p class="restrictive-message__info" data-langkey="res-mes-info"></p>\n      </div>\n      ';const s=new t(e);await s.preloadImages()}bindListeners(){this.scoreContainer.addEventListener("click",(e=>{const{target:t}=e;t.classList.contains("score__item")&&t.querySelector(".popup-score").classList.toggle("hidden")}))}async getScoreResults(){const e=JSON.parse(localStorage.getItem(`${this.type}Results`)).find((e=>e.name===this.category)).results,t=await o(this.type,this.langValue);this.scoreResults=e.map((e=>({...t.find((t=>t.imageNum===e.imageNum)),isCorrect:e.isCorrect})))}async mounted(){this.scoreContainer=document.querySelector("#scoreContainer"),await this.getScoreResults(),await this.scoreToHtml(),await this.translatePage(),this.setHeader(),document.querySelector("#totalScore").textContent=this.totalScore,this.bindListeners()}mount(){return`\n    <header>\n      <div class="container">\n        <div class="header header-score">\n          <a href="/categories/${this.type}" class="header-score__nav header__nav--left header__nav btn" title="back" data-link><ion-icon name="chevron-back-outline"></ion-icon></a>\n          <a href="/" class="header-quiz__nav header__nav header__nav--right btn" title="home" data-link><ion-icon name="home"></ion-icon></a>\n          <h1 class="header__title" data-langkey="score">score.</h1>\n        </div>\n      </div>\n    </header>\n\n    <main class="main">\n      <div class="container">\n        <div class="score-header"><span id="scoreHeader"></span>: <span id="totalScore"></span>/10</div>\n        <div class="score" id="scoreContainer"></div>\n      </div>\n    </main>\n\n    <footer>\n      <div class="container">\n        <div class="footer">\n          <a class="footer__github" href="https://github.com/liliyavoloshina">liliyavoloshina</a>\n          <div class="footer__year">© 2021</div>\n          <a class="footer__school" href="https://rs.school/js/" title="Rolling Scopes School"></a>\n        </div>\n      </div>\n    </footer>\n    `}},w=class extends e{constructor(e){super({...e,type:"blitz"});const t="en"===this.langValue?"blitz":"быстрая игра";this.setTitle(`artquiz. - ${t}.`),this.questions=[],this.correctAnswers=0,this.currentQuestion=0,this.timerTimeout=!1,this.timerInterval=!1,this.totalTime=60,this.timeLeft=this.totalTime}findElements(){this.questionTextEl=document.querySelector("#blitzQuestion"),this.header=document.querySelector("#header")}bind(){document.querySelectorAll(".answer").forEach((e=>{e.addEventListener("click",(e=>this.answer(e)))}))}observeLocation(){const e=document.querySelector("#backBtn"),t=document.querySelector("#homeBtn"),s=document.querySelector("#nextQuizBtn");e.addEventListener("click",(()=>{this.stopTimer()})),t.addEventListener("click",(()=>{this.soundResults.pause()})),s.addEventListener("click",(()=>{this.soundResults.pause()})),window.addEventListener("popstate",(()=>{this.stopTimer(),this.soundResults&&this.soundResults.pause()}))}async getQuestions(){const e=await o("artists",this.langValue),t=await o("pictures",this.langValue);this.questions=[...e,...t],a(this.questions)}async generateImages(){const e=[];this.questions.forEach((async t=>{e.push(`/img/full/${t.imageNum}full.webp`)}));const s=new t(e);await s.preloadImages("four"),this.showImage()}showImage(){const e=document.querySelector("#blitzImage");e&&(e.src=`/img/full/${this.questions[this.currentQuestion].imageNum}full.webp`)}getRandomAuthor(e){let t=null;for(;null===t;){const s=this.questions[Math.floor(Math.random()*this.questions.length)].author;s!==e&&(t=s)}return t}generateQuestion(){this.shouldBeCorrect=Math.random()<.5;let e=null;const t=this.questions[this.currentQuestion].author;e=this.shouldBeCorrect?t:this.getRandomAuthor(t),this.questionTextEl.textContent="en"===this.langValue?`is ${e} author of this picture?`:`${e} написал эту картину?`}showNextQuestion(){const e=document.querySelectorAll(".answer");setTimeout((()=>{e.forEach((e=>{e.disabled=!1,e.classList.remove("disabled"),e.classList.remove("correct"),e.classList.remove("incorrect")}))}),200),this.showImage(),this.generateQuestion()}answer(e){const t=e.target,s=!!e.target.dataset.answer===this.shouldBeCorrect;s?(t.classList.add("correct"),this.correctAnswers++,this.updateTimer("correct")):(t.classList.add("incorrect"),this.updateTimer("wrong")),t.classList.add("disabled"),t.disabled=!0,this.playSound.play(s),100!==this.currentQuestion?(this.currentQuestion++,this.showNextQuestion()):this.showResults()}updateResults(){this.results.push({wins:this.correctAnswers}),localStorage.setItem("blitzResults",JSON.stringify(this.results))}showResults(){this.updateResults();const e=document.querySelector("#modalResult"),t=document.querySelector("#resultsText"),s=document.querySelector("#correctAnswersCount"),i=document.querySelector("#record"),n=this.results.some((e=>e.wins>this.correctAnswers||0===this.correctAnswers));let a;if(this.soundResults=new Audio,this.soundResults.volume=this.soundValue,n)a="en"===this.langValue?"you can do better!":"ты можешь лучше!",this.soundResults.src="/audio/failure.wav";else{a="en"===this.langValue?"this is your record!":"это твой рекорд!",this.soundResults.src="/audio/applause.wav";const e=new y;e.mount(),e.init()}this.isWithSound&&this.soundResults.play(),i.textContent=a,t.textContent="en"===this.langValue?`this is your ${this.results.length} time`:`это твоя ${this.results.length} игра`,s.textContent="en"===this.langValue?`and you answer ${this.correctAnswers} correct!`:`и ты ответил на ${this.correctAnswers} вопросов правильно!`,e.classList.remove("hidden"),this.stopTimer()}stopTimer(){this.timer&&(clearTimeout(this.timerTimeout),clearInterval(this.timerInterval),this.timer.stopTimer())}updateTimer(e){const t=document.querySelector("#addedTime");t.classList.remove("hidden"),"correct"===e?(this.timeLeft+=2,t.classList.remove("incorrect"),t.textContent="+2"):(this.timeLeft-=2,t.textContent="-2",t.classList.add("incorrect")),this.stopTimer(),this.timeLeft>=60&&(this.timeLeft=this.totalTime),this.destroyTimer(),this.initTimer(),this.setTimeout(this.timeLeft),this.setInterval(),setTimeout((()=>{t.classList.add("hidden")}),1e3)}setTimeout(e){this.timerTimeout=setTimeout((()=>{this.showResults()}),1e3*e)}setInterval(){this.timerInterval=setInterval((()=>{this.timeLeft--}),1e3)}destroyTimer(){const e=document.querySelector(".timer");this.header.removeChild(e)}initTimer(){this.timer=new p(this.timeLeft,"blitz"),this.timer.mount(this.header),this.timer.initTimer()}async mounted(){this.findElements(),this.observeLocation(),this.bind(),await this.getQuestions(),await this.generateImages(),this.generateQuestion(),this.playSound=new u(this.isWithSound,this.soundValue),this.initTimer(),this.setTimeout(this.totalTime),this.setInterval(),this.translatePage()}mount(){return'\n    <header>\n      <div class="container">\n        <div class="header header-quiz" id="header">\n          <a href="/" class="header-quiz__nav header__nav header__nav--left btn" id="backBtn" data-link title="back"><ion-icon name="chevron-back-outline"></ion-icon></a>\n        </div>\n      </div>\n    </header>\n\n    <main class="main main-fullheight">\n      <div class="container">\n        <div class="blitz">\n          <div class="blitz__question" id="blitzQuestion"></div>\n          <div class="blitz__image image-loading">\n            <img\n              id="blitzImage"\n              src="/img/full/200full.webp"\n              alt=""\n            />\n          </div>\n          <div class="blitz__answers" id="blitzAnswers">\n            <button class="answer-btn answer" data-answer="true" data-langkey="yes">yes</button>\n            <button class="answer-btn answer" data-answer="" data-langkey="no">no</button>\n          </div>\n        </div>\n      </div>\n    </main>\n\n    <div class="modal-center hidden" id="modalResult">\n      <div class="modal-center__content">\n        <div class="modal-center__title" id="record"></div>\n        <div class="modal-center__info modal-center__info-blitz">\n          <div id="resultsText"></div>\n          <div id="correctAnswersCount"></div> \n        </div>\n        <div class="modal-center__actions">\n          <a href="/" class="btn" id="homeBtn" data-link data-langkey="home">home</a>\n          <a href="/blitz" class="btn" id="nextQuizBtn" data-link data-langkey="try-again">try again?</a>\n        </div>\n      </div>\n    </div>\n    \n    <footer>\n      <div class="container">\n        <div class="footer">\n            <a class="footer__github" href="https://github.com/liliyavoloshina">liliyavoloshina</a>\n            <div class="footer__year">© 2021</div>\n            <a class="footer__school" href="https://rs.school/js/" title="Rolling Scopes School"></a>\n        </div>\n      </div>\n    </footer>\n    '}},b=async()=>{const e=[{path:"/",View:s},{path:"/settings",View:d},{path:"/categories/:type",View:h},{path:"/quiz/:type/:category",View:f},{path:"/score/:type/:category",View:_},{path:"/blitz",View:w}];let t=e.map((e=>{return{route:e,result:window.location.pathname.match((t=e.path,new RegExp(`^${t.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")}$`)))};var t})).find((e=>null!==e.result));t||(t={route:e[0],result:[window.location.pathname]},window.location.pathname="/");const i=new t.route.View((e=>{const t=e.result.slice(1),s=Array.from(e.route.path.matchAll(/:(\w+)/g)).map((e=>e[1]));return Object.fromEntries(s.map(((e,s)=>[e,t[s]])))})(t));document.querySelector("#app").innerHTML=i.mount(),i.mounted()};window.addEventListener("popstate",b),document.addEventListener("DOMContentLoaded",(()=>{document.addEventListener("click",(e=>{var t;e.target.matches("[data-link]")&&(e.preventDefault(),t=e.target.href,window.history.pushState(null,null,t),b())})),b()}))})();